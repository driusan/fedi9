#!/bin/rc

fedi9lib=$home/lib/fedi9
actorsdb=$fedi9lib/actors.db
followreqdb=$fedi9lib/followreq.db
followersdb=$fedi9lib/followers.db
followingdb=$fedi9lib/following.db

objectsdb=$fedi9lib/objects.db

undodb=$fedi9lib/undo.db
announcedb=$fedi9lib/announces.db

me=`{ndb/query -f $actorsdb self true id}

if (~ $"fedidomain '') {
	echo fedidomain not set >[1=2]
	exit 'no domain'
}

# Helpers shared between mkactivity and mkobject
fn quoteRequiredValue {
	switch($1){
	case null
		echo null
	case ''
		echo null
	case *
		echo '"'$1'"'
	}
}

fn optionalValue {
	key=$1
	value=$2
	switch ($"value){
	case null
	case ''
	case *
		echo
		echo '"'$"key'" : "'$"value'"',
	}
}
fn requiredArray {
	echo -n '['
	while (! ~ $#* 0) {
		echo -n '"'$1'"'
		shift
		if (! ~ $#* 0) {
			echo -n ,
		}
	}
	echo ']'
}

fn addObjectToDb {
	objectid=$1
	shift
	if (~ `{ndb/query $objectsdb id $"objectid} ''){
		cachepath=objects/^`{echo $objectid | sed -e 's#(http[s]?://)##'}
		echo mkdir -p $fedi9lib^`{basename -d $cachepath}
		cat

	}	
}
